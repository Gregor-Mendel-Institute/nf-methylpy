/*
 * ----------------------------------------------------------------------------
 *  Nextflow config file for use with CLIP
 * ----------------------------------------------------------------------------
 * Defines basic usage limits and singularity image id.
 */

process {
  executor = 'slurm'
  // clusterOptions = { "-P $params.project " }
}

executor {
  $slurm {
    name = 'cbe'
    queueSize = 1600
  }
}

params {
  max_memory = 180.GB
  max_cpus = 12
  max_time = 24.h
  aligner = 'methylpy'
  tmpdir = "$SCRATCHDIR/tempFiles"
}


process {
  cpus = 1
  memory = 10.GB
  time = 6.h
  //clusterOptions = '--q short '
  scratch = "$SCRATCHDIR/tempFiles"

  errorStrategy = { task.exitStatus in [143,137] ? 'retry' : 'terminate' }
  maxRetries = 3
  maxErrors = '-1'

  module = ['anaconda3/2019.03']
  conda = '/users/rahul.pisupati/.conda/envs/methylpy'

  withLabel: env_quality {
    cpus = 2
    memory = 20.GB
    time = 6.h
  }

  withLabel: env_picard_small {
    cpus = 1
    memory = 10.GB
    time = 4.h
  }

  withLabel: env_picard {
    cpus = 2
    memory = 24.GB
    time = 6.h
  }

  withLabel: env_methylpy {
    cpus = 8
    memory = 80.GB
    time = 8.h
    //module = ['methylpy/1.2.9-foss-2018b-python-2.7.15']
  }

  withLabel: env_pybshap {
    cpus = 2
    memory = 20.GB
    time = 2.h
    conda = '/users/rahul.pisupati/.conda/envs/pybshap'
  }

  withLabel: env_snpcall {
    module = ['gatk/3.8-1-java-1.8']
    cpus = 4
    memory = 48.GB
    time = 8.h
  }
}
